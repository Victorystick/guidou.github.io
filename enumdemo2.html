<!DOCTYPE html>
<html>
  <head>
    <title>enumeration demo</title>
  </head>
  <body>
    Devices:
    <ul id="devicelist"></ul>
    <button id="refresh" onclick="refreshDeviceList(false, device_list);">Refresh device list</button><br>


<script>
var device_list = null;

window.onload = onLoad;

function onLoad() {
  device_list = document.getElementById("devicelist");
  navigator.webkitGetUserMedia(
      {audio:true},
      function(stream) {
        refreshDeviceList(true,device_list);
        stream.stop();
        console.log("stream closed");
      },
      function(err) {alert(err);}
  );
}

function addItem(strItem) {
  var item = document.createElement("li");
  item.innerHTML = strItem;
  the_list.appendChild(item);
}
function refreshDeviceList(selectFirst, the_list) {
  while( the_list.firstChild ){
      the_list.removeChild( the_list.firstChild );
  }
  if (!navigator.mediaDevices) {
    addItem('navigator.mediaDevices not supported');
    return;
  }
  if (!navigator.mediaDevices.enumerateDevices) {
    addItem('enumerateDevices not supported');
    return;
  }
  navigator.mediaDevices.enumerateDevices().then( function(infos) {
    var count = 0;
    for (var i = 0; i < infos.length; i++) {
      count++;
      addItem('' + (count) + ' - ' +  infos[i].kind + ' - ' + infos[i].deviceId + ' - ' + infos[i].label);
    }
  }, function(msg) {
    alert('Something wrong: ' + msg);
  });
}

</script>

  </body>
</html>
